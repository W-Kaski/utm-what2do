<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.utm.what2do.mapper.UserMapper">

    <resultMap id="UserVoMap" type="com.utm.what2do.model.vo.UserVO">
        <id property="id" column="id" />
        <result property="utorid" column="utorid" />
        <result property="email" column="email" />
        <result property="displayName" column="display_name" />
        <result property="faculty" column="faculty" />
        <result property="yearOfStudy" column="year_of_study" />
    </resultMap>

    <select id="selectUsers" resultMap="UserVoMap">
        SELECT u.id,
               u.utorid,
               u.email,
               u.display_name,
               u.faculty,
               u.year_of_study
        FROM user u
        <where>
            u.deleted = 0
            <if test="query.keyword != null and query.keyword != ''">
                AND (u.utorid LIKE CONCAT('%', #{query.keyword}, '%')
                    OR u.display_name LIKE CONCAT('%', #{query.keyword}, '%')
                    OR u.email LIKE CONCAT('%', #{query.keyword}, '%'))
            </if>
        </where>
        ORDER BY u.created_at DESC
    </select>
</mapper>

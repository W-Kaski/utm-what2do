<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.utm.what2do.mapper.RegistrationMapper">

    <resultMap id="RegistrationVoMap" type="com.utm.what2do.model.vo.RegistrationVO">
        <id property="id" column="id" />
        <result property="activityId" column="activity_id" />
        <result property="activityTitle" column="activity_title" />
        <result property="userId" column="user_id" />
        <result property="userName" column="user_name" />
        <result property="status" column="status" />
        <result property="registeredAt" column="registered_at" />
        <result property="remarks" column="remarks" />
    </resultMap>

    <select id="selectRegistrations" resultMap="RegistrationVoMap">
        SELECT r.id,
               r.activity_id,
               a.title AS activity_title,
               r.user_id,
               u.display_name AS user_name,
               r.status,
               r.registered_at,
               r.remarks
        FROM registration r
                 LEFT JOIN activity a ON r.activity_id = a.id
                 LEFT JOIN user u ON r.user_id = u.id
        <where>
            r.deleted = 0
            <if test="query.activityId != null">
                AND r.activity_id = #{query.activityId}
            </if>
            <if test="query.userId != null">
                AND r.user_id = #{query.userId}
            </if>
            <if test="query.status != null and query.status != ''">
                AND r.status = #{query.status}
            </if>
        </where>
        ORDER BY r.registered_at DESC
    </select>
</mapper>

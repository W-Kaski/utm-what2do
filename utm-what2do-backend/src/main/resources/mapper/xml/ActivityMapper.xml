<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.utm.what2do.mapper.ActivityMapper">

    <resultMap id="ActivityVoMap" type="com.utm.what2do.model.vo.ActivityVO">
        <id property="id" column="id" />
        <result property="organizationId" column="organization_id" />
        <result property="organizationName" column="organization_name" />
        <result property="title" column="title" />
        <result property="summary" column="summary" />
        <result property="location" column="location" />
        <result property="startTime" column="start_time" />
        <result property="endTime" column="end_time" />
        <result property="capacity" column="capacity" />
        <result property="registrationDeadline" column="registration_deadline" />
    </resultMap>

    <select id="selectActivities" resultMap="ActivityVoMap">
        SELECT a.id,
               a.organization_id,
               o.name AS organization_name,
               a.title,
               a.summary,
               a.location,
               a.start_time,
               a.end_time,
               a.capacity,
               a.registration_deadline
        FROM activity a
                 LEFT JOIN organization o ON a.organization_id = o.id
        <where>
            a.deleted = 0
            <if test="query.organizationId != null">
                AND a.organization_id = #{query.organizationId}
            </if>
            <if test="query.keyword != null and query.keyword != ''">
                AND (a.title LIKE CONCAT('%', #{query.keyword}, '%')
                    OR a.summary LIKE CONCAT('%', #{query.keyword}, '%'))
            </if>
            <if test="query.startFrom != null">
                AND a.start_time &gt;= #{query.startFrom}
            </if>
            <if test="query.endTo != null">
                AND a.end_time &lt;= #{query.endTo}
            </if>
        </where>
        ORDER BY a.start_time ASC
    </select>
</mapper>
